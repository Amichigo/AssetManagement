<div class="data-table-section">
    <div class="data-table-section-header">
        <div class="row">
            <div class="col-md-6">
                <h3 class="data-table-section-header-title">Bảng số liệu thống kê chi tiết</h3>
            </div>

            <div class="col-md-6 text-right">
                <span class="button" (click)="onResetFilters()"><i class="fas fa-redo"></i>&nbsp;&nbsp;Làm lại</span>
                <span class="button" (click)="onExport()"><i class="fas fa-file-download"></i>&nbsp;&nbsp;Xuất dữ liệu</span>
            </div>
        </div>
    </div>

    <div class="data-table-section-body">
        <div class="data-table-filters mb-3">
            <div class="row mb-3">
                <div class="col-md-12">
                    <label>Từ khóa</label>
                    <input class="form-control" type="text" placeholder="Nhập từ khóa cần tìm kiếm..." [(ngModel)]="keyword" (ngModelChange)="loadTableData()" />
                </div>
            </div>
    
            <div class="row">
                <div class="col-md-3">
                    <label>Ngày bắt đầu</label>
                    <input class="form-control" type="date" [(ngModel)]="startingDate" (ngModelChange)="loadTableData()" required />
                </div>
    
                <div class="col-md-3">
                    <label>Ngày kết thúc</label>
                    <input class="form-control" type="date" [(ngModel)]="endingDate" (ngModelChange)="loadTableData()" required />
                </div>
    
                <div class="col-md-3">
                    <label>Số kết quả hiển thị</label>
                    <select class="form-control" [(ngModel)]="pageSize" (ngModelChange)="loadTableData()">
                        <option value="10">10</option>
                        <option value="25">25</option>
                        <option value="50">50</option>
                        <option value="100">100</option>
                        <option value="500">500</option>
                        <option value="1000">1000</option>
                        <option value="2000">2000</option>
                    </select>
                </div>
    
                <div class="col-md-3">
                    <label>Nhóm tài sản</label>
                    <select class="form-control" [(ngModel)]="selectedAssetType" (ngModelChange)="loadTableData()">
                        <option value="-1">Tất cả</option>
                        <option [value]="type['AssetTypeId']" *ngFor="let type of assetTypes">{{ type['AssetTypeName'] }}</option>
                    </select>
                </div>
            </div>
        </div>
    
        <table class="table">
            <thead class="thead-dark">
                <tr>
                    <th (click)="onSort('RecordedDate')">Ngày ghi nhận <span class="sort-button" *ngIf="this.sortField === 'RecordedDate'" ><i class="fas fa-sort"></i></span></th>
                    <th (click)="onSort('AssetTypeId')">Mã nhóm tài sản <span class="sort-button" *ngIf="this.sortField === 'AssetTypeId'" ><i class="fas fa-sort"></i></span></th>
                    <th (click)="onSort('AssetTypeName')">Tên nhóm tài sản <span class="sort-button" *ngIf="this.sortField === 'AssetTypeName'" ><i class="fas fa-sort"></i></span></th>
                    <th (click)="onSort('Quantity')">Số lượng (Tài sản) <span class="sort-button" *ngIf="this.sortField === 'Quantity'" ><i class="fas fa-sort"></i></span></th>
                    <th (click)="onSort('Quantity')">Tỉ lệ % (Số lượng tài sản) <span class="sort-button" *ngIf="this.sortField === 'Quantity'" ><i class="fas fa-sort"></i></span></th>
                    <th (click)="onSort('Amount')">Giá trị đầu tư (VNĐ) <span class="sort-button" *ngIf="this.sortField === 'Amount'" ><i class="fas fa-sort"></i></span></th>
                    <th (click)="onSort('Amount')">Tỉ lệ % (Giá trị đầu tư) <span class="sort-button" *ngIf="this.sortField === 'Amount'" ><i class="fas fa-sort"></i></span></th>
                </tr>
            </thead>
    
            <tbody>
                <tr *ngFor="let record of tableData" (click)="onShowDetailedPopup(record)">
                    <td>{{ record['RecordedDate'] | date:'dd/MM/yyyy' }}</td>
                    <td class="text-bold">{{ record['AssetTypeId'] }}</td>
                    <td>{{ record['AssetTypeName'] }}</td>
                    <td>{{ addThousandSeparator(record['Quantity']) }}</td>
                    <td class="text-bold">{{ ((record['Quantity'] / totalPurchasedAssets) * 100).toFixed(2) }}</td>
                    <td>{{ addThousandSeparator(record['Amount']) }}</td>
                    <td class="text-bold">{{ ((record['Amount'] / totalInvestedAmount) * 100).toFixed(2) }}</td>
                </tr>
            </tbody>
        </table>
    
        <div class="table-pagination">
            <div class="row">
                <div class="col-md-6">
                    Trang <strong>{{ page }}</strong> trong tổng số <strong>{{ totalPages }}</strong> trang
                </div>
    
                <div class="col-md-6 text-right">
                    <span class="paging-button" (click)="navigateToPreviousPage()"><i class="fas fa-chevron-left"></i></span>
                    <span class="paging-button" (click)="navigateToNextPage()"><i class="fas fa-chevron-right"></i></span>
                </div>
            </div>
        </div>
    </div>
</div>